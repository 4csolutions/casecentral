{
  "version": 3,
  "sources": ["../../../../../apps/casecentral/casecentral/public/js/task_quick_entry.js", "../../../../../apps/casecentral/casecentral/public/js/sales_invoice.js"],
  "sourcesContent": ["frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.TaskQuickEntryForm = class TaskQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [{\n            fieldtype: \"MultiSelectPills\",\n            fieldname: \"assign_to\",\n            label: __(\"Assign To\"),\n            get_data: function (txt) {\n                return frappe.db.get_link_options(\"User\", txt, {\n                    user_type: \"System User\",\n                    enabled: 1,\n                });\n            },\n        }];\n\n        return variant_fields;\n    }\n}", "frappe.ui.form.on('Sales Invoice', {\n    refresh: function(frm) {\n\t\tif (cint(frm.doc.docstatus==0) && cur_frm.page.current_view_name!==\"pos\" && !frm.doc.is_return) {\n            frm.add_custom_button(__('Legal Services'), function() {\n                get_legal_services_to_invoice(frm);\n            },__(\"Get Items From\"));\n        }\n    }\n});\n\nvar get_legal_services_to_invoice = function(frm) {\n\tvar me = this;\n    let selected_matter = '';\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Get Items from Legal Services\"),\n\t\tfields:[\n\t\t\t{\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Matter',\n\t\t\t\tlabel: 'Matter',\n\t\t\t\tfieldname: \"matter\",\n\t\t\t\treqd: true\n\t\t\t},\n\t\t\t{ fieldtype: 'Section Break'\t},\n\t\t\t{ fieldtype: 'HTML', fieldname: 'results_area' }\n\t\t]\n\t});\n\tvar $wrapper;\n\tvar $results;\n\tvar $placeholder;\n\tdialog.set_values({\n\t\t'matter': frm.doc.matter\n\t});\n\tdialog.fields_dict[\"matter\"].df.onchange = () => {\n\t\tvar matter = dialog.fields_dict.matter.input.value;\n\t\tif(matter && matter!=selected_matter){\n\t\t\tselected_matter = matter;\n\t\t\tvar method = \"casecentral.utils.get_legal_services_to_invoice\";\n\t\t\tvar args = {matter: matter, company: frm.doc.company};\n\t\t\tvar columns = ([\"service\", \"reference_name\", \"reference_type\"]);\n\t\t\tget_legal_service_items(frm, $results, $placeholder, method, args, columns);\n\t\t}\n\t\telse if(!matter){\n\t\t\tselected_matter = '';\n\t\t\t$results.empty();\n\t\t\t$results.append($placeholder);\n\t\t}\n\t}\n\t$wrapper = dialog.fields_dict.results_area.$wrapper.append(`<div class=\"results\"\n\t\tstyle=\"border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;\"></div>`);\n\t$results = $wrapper.find('.results');\n\t$placeholder = $(`<div class=\"multiselect-empty-state\">\n\t\t\t\t<span class=\"text-center\" style=\"margin-top: -40px;\">\n\t\t\t\t\t<i class=\"fa fa-2x fa-heartbeat text-extra-muted\"></i>\n\t\t\t\t\t<p class=\"text-extra-muted\">No billable Legal Services found</p>\n\t\t\t\t</span>\n\t\t\t</div>`);\n\t$results.on('click', '.list-item--head :checkbox', (e) => {\n\t\t$results.find('.list-item-container .list-row-check')\n\t\t\t.prop(\"checked\", ($(e.target).is(':checked')));\n\t});\n\tset_primary_action(frm, dialog, $results);\n\tdialog.show();\n};\n\nvar get_legal_service_items = function(frm, $results, $placeholder, method, args, columns) {\n\tvar me = this;\n\t$results.empty();\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(data) {\n\t\t\tif(data.message){\n\t\t\t\t$results.append(make_list_row(columns));\n\t\t\t\tfor(let i=0; i<data.message.length; i++){\n\t\t\t\t\t$results.append(make_list_row(columns, data.message[i]));\n\t\t\t\t}\n\t\t\t}else {\n\t\t\t\t$results.append($placeholder);\n\t\t\t}\n\t\t}\n\t});\n}\n\nvar make_list_row= function(columns, result={}) {\n\tvar me = this;\n\t// Make a head row by default (if result not passed)\n\tlet head = Object.keys(result).length === 0;\n\tlet contents = ``;\n\tcolumns.forEach(function(column) {\n\t\tcontents += `<div class=\"list-item__content ellipsis\">\n\t\t\t${\n\t\t\t\thead ? `<span class=\"ellipsis\">${__(frappe.model.unscrub(column))}</span>`\n\n\t\t\t\t:(column !== \"name\" ? `<span class=\"ellipsis\">${__(result[column])}</span>`\n\t\t\t\t\t: `<a class=\"list-id ellipsis\">\n\t\t\t\t\t\t${__(result[column])}</a>`)\n\t\t\t}\n\t\t</div>`;\n\t})\n\n\tlet $row = $(`<div class=\"list-item\">\n\t\t<div class=\"list-item__content\" style=\"flex: 0 0 10px;\">\n\t\t\t<input type=\"checkbox\" class=\"list-row-check\" ${result.checked ? 'checked' : ''}>\n\t\t</div>\n\t\t${contents}\n\t</div>`);\n\n\t$row = list_row_data_items(head, $row, result);\n\treturn $row;\n};\n\nvar set_primary_action= function(frm, dialog, $results) {\n\tvar me = this;\n\tdialog.set_primary_action(__('Add'), function() {\n\t\tlet checked_values = get_checked_values($results);\n\t\tif(checked_values.length > 0){\n            if ( !frm.doc.matter ) {\n                frm.set_value(\"matter\", dialog.fields_dict.matter.input.value);\n            }\n\t\t\tfrm.set_value(\"items\", []);\n\t\t\tadd_to_item_line(frm, checked_values);\n\t\t\tdialog.hide();\n\t\t}\n\t\telse {\n\t\t\tfrappe.msgprint(__(\"Please select Legal Service\"));\n\t\t}\n\t});\n};\n\nvar get_checked_values= function($results) {\n\treturn $results.find('.list-item-container').map(function() {\n\t\tlet checked_values = {};\n\t\tif ($(this).find('.list-row-check:checkbox:checked').length > 0 ) {\n\t\t\tchecked_values['dn'] = $(this).attr('data-dn');\n\t\t\tchecked_values['dt'] = $(this).attr('data-dt');\n\t\t\tchecked_values['item'] = $(this).attr('data-item');\n\t\t\tif($(this).attr('data-rate') != 'undefined'){\n\t\t\t\tchecked_values['rate'] = $(this).attr('data-rate');\n\t\t\t}\n\t\t\telse{\n\t\t\t\tchecked_values['rate'] = false;\n\t\t\t}\n\t\t\tif($(this).attr('data-income-account') != 'undefined'){\n\t\t\t\tchecked_values['income_account'] = $(this).attr('data-income-account');\n\t\t\t}\n\t\t\telse{\n\t\t\t\tchecked_values['income_account'] = false;\n\t\t\t}\n\t\t\tif($(this).attr('data-qty') != 'undefined'){\n\t\t\t\tchecked_values['qty'] = $(this).attr('data-qty');\n\t\t\t}\n\t\t\telse{\n\t\t\t\tchecked_values['qty'] = false;\n\t\t\t}\n\t\t\tif($(this).attr('data-description') != 'undefined'){\n\t\t\t\tchecked_values['description'] = $(this).attr('data-description');\n\t\t\t}\n\t\t\telse{\n\t\t\t\tchecked_values['description'] = false;\n\t\t\t}\n\t\t\treturn checked_values;\n\t\t}\n\t}).get();\n};\n\nvar list_row_data_items = function(head, $row, result) {\n    head ? $row.addClass('list-item--head')\n        : $row = $(`<div class=\"list-item-container\"\n            data-dn= \"${result.reference_name}\" data-dt= \"${result.reference_type}\" data-item= \"${result.service}\"\n            data-rate = ${result.rate}\n            data-income-account = \"${result.income_account}\"\n            data-qty = ${result.qty}\n            data-description = \"${result.description}\">\n            </div>`).append($row);\n\treturn $row\n};\n\nvar add_to_item_line = function(frm, checked_values){\n    console.log(frm.doc);\n    frappe.call({\n        doc: frm.doc,\n        method: \"set_legal_services\",\n        args:{ checked_values: checked_values },\n        callback: function() {\n            frm.trigger(\"validate\");\n            frm.refresh_fields();\n        }\n    });\n};"],
  "mappings": "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",
  "names": []
}
